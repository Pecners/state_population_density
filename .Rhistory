setwd("state_population_density")
m_states <- read_rds("data/states.rds")
library(sf)
library(tidyverse)
library(elevatr)
library(rayshader)
library(glue)
library(colorspace)
library(tigris)
library(stars)
library(NatParksPalettes)
library(rnaturalearth)
map <- "alaska"
# Kontur data source: https://data.humdata.org/organization/kontur
d_layers <- st_layers("data/kontur_population_US_20231101.gpkg")
d_crs <- d_layers[["crs"]][[1]][[2]]
s <- states() |>
st_transform(crs = d_crs)
st <- s |>
filter(NAME == str_to_title(str_replace_all("alaska", "_", " ")))
wkt_st <- st_as_text(st[[1,"geometry"]])
data <- st_read("data/kontur_population_US_20231101.gpkg",
wkt_filter = wkt_st)
land <- rnaturalearth::ne_download(scale = 10, type = "land", category = "physical") |>
st_transform(crs = st_crs(data))
st_land <- st_intersection(st, land)
st_buff <- st_land |>
st_cast("MULTILINESTRING") |>
st_buffer(1609.34 * .5, endCapStyle = "FLAT", joinStyle = "MITRE") |>
mutate(population = 1) |>
rename(geom = geometry)
st_dd <- st_join(data, st, left = FALSE)
st_d <- bind_rows(st_buff, st_dd)
st_d <- st_transform(st_d, crs = 3338)
s <- states() |>
st_as_sf()
skip <- c(
"Puerto Rico",
# "Alaska",
# "Hawaii",
"United States Virgin Islands",
"Commonwealth of the Northern Mariana Islands",
"American Samoa",
"Guam"
)
skinny_s <- s |>
filter(!NAME %in% skip)
m_states <- read_rds("data/states.rds")
check_perc <- function(s) {
t_land <- skinny_s |>
as_tibble() |>
filter(NAME %in% these_states) |>
summarise(total = sum(ALAND)) |>
pull(total)
ak_land <- skinny_s |>
as_tibble() |>
filter(NAME == "Alaska") |>
pull(ALAND)
t_land / ak_land
}
these_states <- c(
"Wisconsin",
"Illinois",
"Michigan",
"Indiana",
# "Minnesota",
# "Iowa",
"Missouri",
"Kentucky",
"Tennessee",
"Mississippi",
"Alabama",
"Georgia",
"Ohio",
"West Virginia"
# "North Dakota",
# "South Dakota",
# "Kansas",
# "Nebraska",
# "Oklahoma"
)
check_perc(these_states)
m_states |>
ggplot(aes(fill = ifelse(NAME %in% these_states, TRUE, FALSE))) +
geom_sf(color = "white") +
scale_fill_manual(values = c("#0f204b", "#ffb612")) +
coord_sf(crs = 2163) +
theme_void() +
theme(legend.position = "none")
this_gg <- m_states |>
ggplot(aes(fill = ifelse(NAME %in% these_states, TRUE, FALSE))) +
geom_sf_interactive(color = "white", aes(tooltip = NAME)) +
scale_fill_manual(values = c("#0f204b", "#ffb612")) +
coord_sf(crs = 2163) +
theme_void() +
theme(legend.position = "none")
library(ggiraph)
this_gg <- m_states |>
ggplot(aes(fill = ifelse(NAME %in% these_states, TRUE, FALSE))) +
geom_sf_interactive(color = "white", aes(tooltip = NAME)) +
scale_fill_manual(values = c("#0f204b", "#ffb612")) +
coord_sf(crs = 2163) +
theme_void() +
theme(legend.position = "none")
girafe(this_gg)
this_gg <- m_states |>
ggplot(aes(fill = ifelse(NAME %in% these_states, TRUE, FALSE))) +
geom_sf_interactive(color = "white") +
scale_fill_manual(values = c("#0f204b", "#ffb612")) +
coord_sf(crs = 2163) +
theme_void() +
theme(legend.position = "none")
girafe(this_gg)
m_states |>
ggplot(aes(fill = ifelse(NAME %in% these_states, TRUE, FALSE))) +
geom_sf_interactive(color = "white")
m_states |>
ggplot(aes(fill = ifelse(NAME %in% these_states, TRUE, FALSE))) +
geom_sf_interactive(color = "white", aes(tooltip = NAME))
girafe()
this_gg <- m_states |>
ggplot(aes(fill = ifelse(NAME %in% these_states, TRUE, FALSE))) +
geom_sf_interactive(color = "white", aes(tooltip = NAME))
girafe(this_gg)
ggiraph(this_gg)
?geom_sf_interactive
girafe(ggobj = this_gg)
this_gg <- m_states |>
ggplot(aes(fill = ifelse(NAME %in% these_states, TRUE, FALSE))) +
geom_sf_interactive(color = "white", aes(tooltip = NAME)) +
scale_fill_manual(values = c("#0f204b", "#ffb612")) +
coord_sf(crs = 2163) +
theme_void() +
theme(legend.position = "none")
girafe(ggobj = this_gg)
